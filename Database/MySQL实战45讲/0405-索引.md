**索引**的出现就是为了提高数据查询的效率，就像书的目录一样。

对于数据库的表而言，索引其实就是它的目录。





为什么数据库存储使用`B+`树，而不是二叉树，因为二叉树树高过高，每次查询都需要访问过多节点，访问数据块过多，而磁盘随机读取数据块过于耗时



100万节点的平衡二叉树，树高20

一次查询可能访问20个数据块

从磁盘随机读一个数据块需要10ms左右的寻址时间。也就是说对于一个100万上的表，如果使用二叉树来存储。单独访问一个行可能需要20个10ms的时间。 慢！



想要让访问速度快，就要减少树高，让树有更多的叉

N叉树中的N取决于数据块的大小。



以InnoDB的一个整数字段索引为例子，这个N差不多是`1200`。

这棵树高4的时候就可以存 1200的3次方个值，17亿

一个10亿行的表傻姑娘一个整数字段的索引，查找一个值最多只需要访问3次磁盘。



N叉树由于在读写性能上的优点，以及适配 磁盘的访问模式，已经被广泛应用在数据库引擎中了。



InnoDB使用了B+树索引模型，所以数据都是存储在B+树中的

每一个**索引**在innoDB里面对应一棵B+树





假设，我们有一个主键列为 ID 的表，表中有字段 k，并且在 k 上有索引。

```sql
create table T(
id int primary key, 
k int not null, 
name varchar(16),
index (k))engine=InnoDB;
```

<img src="/Users/xuzheng/Projects/notes/Database/MySQL实战45讲/0405-索引.assets/mysql45-index-1.png" alt="mysql45-index-1" style="zoom:80%;" />





根据`叶子节点`的内容，索引类型分为`主键索引`和`非主键索引`。



`主键索引`的叶子节点存的是`整行`数据

在 InnoDB 里，主键索引也被称为聚簇索引（clustered index）。



`非主键索引`的叶子节点内容是`主键`的值。

在InnoDB中，`非主键索引`也被称二级索引（secondary index）



基于主键索引和普通索引的查询有什么区别？

* 如果语句是` select * from T where ID=500`，即主键查询方式，则只需要搜索 ID 这棵 B+ 树；

* 如果语句是 select * from T where k=5，即普通索引查询方式，则需要先搜索 k 索引树，得到 ID 的值为 500，再到 ID 索引树搜索一次。这个过程称为`回表`。

基于非主键索引的查询需要多扫描一棵索引树。因此，我们在应用中应该尽量使用主键查询。



